{
  "filename": "deploy-cluster.md",
  "__html": "<h1 id=\"server%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2\">server集群部署 <a class=\"header-anchor\" href=\"#server%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2\">#</a></h1>\n<p>适用于生产环境，需要保证高可用。\n注册中心推荐使用：nacos、zookeeper<br>\n存储类型推荐使用： jdbc、 redis、shard-redis、redis-cluster\n任务部署方式推荐采用：quartz集群模式</p>\n<p>以下以注册中心[nacos]+存储类型[redis]+任务部署类型[quartz集群模式]这种组合为例。</p>\n<h2 id=\"%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5\">准备阶段 <a class=\"header-anchor\" href=\"#%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5\">#</a></h2>\n<h3 id=\"%E5%87%86%E5%A4%87%E8%87%B3%E5%B0%91%E4%B8%A4%E5%8F%B0%E6%9C%BA%E5%99%A8\">准备至少两台机器 <a class=\"header-anchor\" href=\"#%E5%87%86%E5%A4%87%E8%87%B3%E5%B0%91%E4%B8%A4%E5%8F%B0%E6%9C%BA%E5%99%A8\">#</a></h3>\n<p>实例1：192.168.108.179<br>\n实例2：192.168.108.28<br>\n<strong>注意</strong>: 对于nacos、redis、mysql正常情况是需要独立实例部署的，这里考虑到机器资源有限，暂时在实例1上部署了。</p>\n<h3 id=\"%E5%AE%89%E8%A3%85nacos\">安装nacos <a class=\"header-anchor\" href=\"#%E5%AE%89%E8%A3%85nacos\">#</a></h3>\n<p>地址为：192.168.108.179:8848</p>\n<h3 id=\"%E5%AE%89%E8%A3%85redis\">安装redis <a class=\"header-anchor\" href=\"#%E5%AE%89%E8%A3%85redis\">#</a></h3>\n<p>地址为：192.168.108.179:6379</p>\n<h3 id=\"%E5%88%9D%E5%A7%8B%E5%8C%96quartz%E6%95%B0%E6%8D%AE%E5%BA%93\">初始化quartz数据库 <a class=\"header-anchor\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96quartz%E6%95%B0%E6%8D%AE%E5%BA%93\">#</a></h3>\n<p>在192.168.108.179创建数据库\n这里使用mysql数据库，最新脚本请<a href=\"https://github.com/changmingxie/tcc-transaction/blob/master-2.x/tcc-transaction-server/src/main/dbscripts/db_init.sql\">查看</a></p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">CREATE</span>\n<span class=\"hljs-keyword\">DATABASE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`TCC_SERVER`</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> <span class=\"hljs-string\">'utf8mb4'</span> <span class=\"hljs-keyword\">COLLATE</span> <span class=\"hljs-string\">'utf8mb4_unicode_ci'</span>;\n\n<span class=\"hljs-keyword\">USE</span>\n<span class=\"hljs-string\">`TCC_SERVER`</span>;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_FIRED_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_PAUSED_TRIGGER_GRPS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_SCHEDULER_STATE;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_LOCKS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_SIMPLE_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_SIMPROP_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_CRON_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_BLOB_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_TRIGGERS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_JOB_DETAILS;\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> QRTZ_CALENDARS;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_JOB_DETAILS\n(\n    SCHED_NAME        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_NAME          <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_GROUP         <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    DESCRIPTION       <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-literal\">NULL</span>,\n    JOB_CLASS_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    IS_DURABLE        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    IS_NONCONCURRENT  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    IS_UPDATE_DATA    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    REQUESTS_RECOVERY <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_DATA          <span class=\"hljs-built_in\">BLOB</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, JOB_NAME, JOB_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_TRIGGERS\n(\n    SCHED_NAME     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_NAME       <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_GROUP      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    DESCRIPTION    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-literal\">NULL</span>,\n    NEXT_FIRE_TIME <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-literal\">NULL</span>,\n    PREV_FIRE_TIME <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-literal\">NULL</span>,\n    <span class=\"hljs-keyword\">PRIORITY</span>       <span class=\"hljs-built_in\">INTEGER</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_STATE  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">16</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_TYPE   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">8</span>)   <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    START_TIME     <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    END_TIME       <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-literal\">NULL</span>,\n    CALENDAR_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-literal\">NULL</span>,\n    MISFIRE_INSTR  <span class=\"hljs-built_in\">SMALLINT</span>(<span class=\"hljs-number\">2</span>) <span class=\"hljs-literal\">NULL</span>,\n    JOB_DATA       <span class=\"hljs-built_in\">BLOB</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, JOB_NAME, JOB_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_JOB_DETAILS (SCHED_NAME, JOB_NAME, JOB_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_SIMPLE_TRIGGERS\n(\n    SCHED_NAME      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    REPEAT_COUNT    <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">7</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    REPEAT_INTERVAL <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">12</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TIMES_TRIGGERED <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">10</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_CRON_TRIGGERS\n(\n    SCHED_NAME      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CRON_EXPRESSION <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TIME_ZONE_ID    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">80</span>),\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_SIMPROP_TRIGGERS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    STR_PROP_1    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">512</span>) <span class=\"hljs-literal\">NULL</span>,\n    STR_PROP_2    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">512</span>) <span class=\"hljs-literal\">NULL</span>,\n    STR_PROP_3    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">512</span>) <span class=\"hljs-literal\">NULL</span>,\n    INT_PROP_1    <span class=\"hljs-built_in\">INT</span> <span class=\"hljs-literal\">NULL</span>,\n    INT_PROP_2    <span class=\"hljs-built_in\">INT</span> <span class=\"hljs-literal\">NULL</span>,\n    LONG_PROP_1   <span class=\"hljs-built_in\">BIGINT</span> <span class=\"hljs-literal\">NULL</span>,\n    LONG_PROP_2   <span class=\"hljs-built_in\">BIGINT</span> <span class=\"hljs-literal\">NULL</span>,\n    DEC_PROP_1    <span class=\"hljs-built_in\">NUMERIC</span>(<span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span>,\n    DEC_PROP_2    <span class=\"hljs-built_in\">NUMERIC</span>(<span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span>,\n    BOOL_PROP_1   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    BOOL_PROP_2   <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_BLOB_TRIGGERS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    BLOB_DATA     <span class=\"hljs-built_in\">BLOB</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">INDEX</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),\n    <span class=\"hljs-keyword\">FOREIGN</span> <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n        <span class=\"hljs-keyword\">REFERENCES</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_CALENDARS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CALENDAR_NAME <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CALENDAR      <span class=\"hljs-built_in\">BLOB</span>         <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, CALENDAR_NAME)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_PAUSED_TRIGGER_GRPS\n(\n    SCHED_NAME    <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, TRIGGER_GROUP)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_FIRED_TRIGGERS\n(\n    SCHED_NAME        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    ENTRY_ID          <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">95</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_NAME      <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    TRIGGER_GROUP     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    INSTANCE_NAME     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    FIRED_TIME        <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    SCHED_TIME        <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    <span class=\"hljs-keyword\">PRIORITY</span>          <span class=\"hljs-built_in\">INTEGER</span>      <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    STATE             <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">16</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    JOB_NAME          <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-literal\">NULL</span>,\n    JOB_GROUP         <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-literal\">NULL</span>,\n    IS_NONCONCURRENT  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    REQUESTS_RECOVERY <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, ENTRY_ID)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_SCHEDULER_STATE\n(\n    SCHED_NAME        <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    INSTANCE_NAME     <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">190</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    LAST_CHECKIN_TIME <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    CHECKIN_INTERVAL  <span class=\"hljs-built_in\">BIGINT</span>(<span class=\"hljs-number\">13</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, INSTANCE_NAME)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> QRTZ_LOCKS\n(\n    SCHED_NAME <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">120</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    LOCK_NAME  <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">40</span>)  <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n    PRIMARY <span class=\"hljs-keyword\">KEY</span> (SCHED_NAME, LOCK_NAME)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_J_REQ_RECOVERY <span class=\"hljs-keyword\">ON</span> QRTZ_JOB_DETAILS (SCHED_NAME, REQUESTS_RECOVERY);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_J_GRP <span class=\"hljs-keyword\">ON</span> QRTZ_JOB_DETAILS (SCHED_NAME, JOB_GROUP);\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_J <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_JG <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_C <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, CALENDAR_NAME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_G <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_STATE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_N_STATE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_N_G_STATE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_GROUP, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NEXT_FIRE_TIME <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, NEXT_FIRE_TIME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_ST <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_STATE, NEXT_FIRE_TIME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_MISFIRE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_ST_MISFIRE <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_STATE);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_T_NFT_ST_MISFIRE_GRP <span class=\"hljs-keyword\">ON</span> QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_GROUP,\n                                                             TRIGGER_STATE);\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_TRIG_INST_NAME <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_INST_JOB_REQ_RCVRY <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME, REQUESTS_RECOVERY);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_J_G <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_JG <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, JOB_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_T_G <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP);\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">INDEX</span> IDX_QRTZ_FT_TG <span class=\"hljs-keyword\">ON</span> QRTZ_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);\n\n<span class=\"hljs-keyword\">commit</span>;\n\n</code></pre>\n<h3 id=\"%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0release%E7%89%88%E6%9C%AC\">下载最新<a href=\"https://github.com/changmingxie/tcc-transaction/releases\">RELEASE</a>版本 <a class=\"header-anchor\" href=\"#%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0release%E7%89%88%E6%9C%AC\">#</a></h3>\n<p>下载最新的安装包tcc-transaction-server-xxx.tar.gz</p>\n<h2 id=\"%E5%AE%9E%E4%BE%8B1%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8\">实例1安装并启动 <a class=\"header-anchor\" href=\"#%E5%AE%9E%E4%BE%8B1%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8\">#</a></h2>\n<h3 id=\"%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%88%9B%E5%BB%BAserver%E7%9B%AE%E5%BD%95%E5%B9%B6%E8%A7%A3%E5%8E%8B\">第一步 创建server目录并解压 <a class=\"header-anchor\" href=\"#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%88%9B%E5%BB%BAserver%E7%9B%AE%E5%BD%95%E5%B9%B6%E8%A7%A3%E5%8E%8B\">#</a></h3>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">%</span><span class=\"bash\"> makdir server </span>\n<span class=\"hljs-meta\">%</span><span class=\"bash\"> <span class=\"hljs-built_in\">cd</span>  server  </span>\nserver % tar zxvf tcc-transaction-server-2.0.0.tar.gz\nx conf/application.yaml\nx lib/tcc-transaction-server.jar\nx conf/\nx conf/logback.xml\nx bin/\nx bin/startup.sh\nx bin/startup.cmd\nx bin/shutdown.sh\nx bin/shutdown.cmd\nserver % tree\n.\n├── bin\n│         ├── shutdown.cmd\n│         ├── shutdown.sh\n│         ├── startup.cmd\n│         └── startup.sh\n├── conf\n│         ├── application.yaml\n│         └── logback.xml\n├── lib\n│         └── tcc-transaction-server.jar\n└── tcc-transaction-server-2.0.0.tar.gz\n\n3 directories, 8 files\nserver % \n</code></pre>\n<h3 id=\"%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E4%BF%AE%E6%94%B9application.yaml%E9%85%8D%E7%BD%AE\">第二步 修改application.yaml配置 <a class=\"header-anchor\" href=\"#%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E4%BF%AE%E6%94%B9application.yaml%E9%85%8D%E7%BD%AE\">#</a></h3>\n<p><a href=\"/zh-cn/docs/tutorial/configurations.html#server%E7%AB%AF\">参数说明详见</a><br>\n这里以注册中心[nacos]+存储类型[redis]+任务部署类型[quartz集群模式]为例，对应的application.yaml可如下</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">12332</span>\n<span class=\"hljs-attr\">logging:</span>\n  <span class=\"hljs-attr\">level:</span>\n    <span class=\"hljs-attr\">root:</span> <span class=\"hljs-string\">info</span>\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">tcc-transaction-server</span>\n  <span class=\"hljs-attr\">tcc:</span>\n    <span class=\"hljs-attr\">storage:</span>\n      <span class=\"hljs-attr\">storage-type:</span> <span class=\"hljs-string\">redis</span>\n      <span class=\"hljs-attr\">redis:</span>\n        <span class=\"hljs-attr\">host:</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.108</span><span class=\"hljs-number\">.179</span>\n        <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">6379</span>\n        <span class=\"hljs-attr\">database:</span> <span class=\"hljs-number\">0</span>\n        <span class=\"hljs-attr\">pool-config:</span>\n          <span class=\"hljs-attr\">max-total:</span> <span class=\"hljs-number\">100</span>\n          <span class=\"hljs-attr\">max-idle:</span> <span class=\"hljs-number\">100</span>\n          <span class=\"hljs-attr\">min-idle:</span> <span class=\"hljs-number\">10</span>\n          <span class=\"hljs-attr\">max-wait-millis:</span> <span class=\"hljs-number\">300</span>\n    <span class=\"hljs-attr\">recovery:</span>\n      <span class=\"hljs-attr\">recovery-enabled:</span> <span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-attr\">update-job-forcibly:</span> <span class=\"hljs-literal\">false</span>\n      <span class=\"hljs-attr\">quartz-clustered:</span> <span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-attr\">quartz-data-source-url:</span> <span class=\"hljs-string\">jdbc:mysql://192.168.108.179:3306/TCC_SERVER?useSSL=false&amp;allowPublicKeyRetrieval=true</span>\n      <span class=\"hljs-attr\">quartz-data-source-driver:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n      <span class=\"hljs-attr\">quartz-data-source-user:</span> <span class=\"hljs-string\">root</span>\n      <span class=\"hljs-attr\">quartz-data-source-password:</span> <span class=\"hljs-string\">welcome1</span>\n    <span class=\"hljs-attr\">registry:</span>\n      <span class=\"hljs-attr\">registry-type:</span> <span class=\"hljs-string\">nacos</span>\n      <span class=\"hljs-attr\">cluster-name:</span> <span class=\"hljs-string\">default</span>\n      <span class=\"hljs-attr\">nacos:</span>\n        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.108</span><span class=\"hljs-number\">.179</span><span class=\"hljs-string\">:8848</span>\n    <span class=\"hljs-attr\">remoting:</span>\n      <span class=\"hljs-attr\">listen-port:</span> <span class=\"hljs-number\">2332</span>\n\n</code></pre>\n<h3 id=\"%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%90%AF%E5%8A%A8server\">第三步 启动server <a class=\"header-anchor\" href=\"#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%90%AF%E5%8A%A8server\">#</a></h3>\n<pre><code class=\"language-shell\">sh bin/startup.sh\n</code></pre>\n<h2 id=\"%E5%AE%9E%E4%BE%8B2%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8\">实例2安装并启动 <a class=\"header-anchor\" href=\"#%E5%AE%9E%E4%BE%8B2%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8\">#</a></h2>\n<p>参考<strong>实例1安装并启动</strong></p>\n<h2 id=\"%E9%AA%8C%E8%AF%81\">验证 <a class=\"header-anchor\" href=\"#%E9%AA%8C%E8%AF%81\">#</a></h2>\n<p>实例1和实例2正常启动后，会在nacos显示如下信息。\n<img src=\"../../img/nacos_server_list.jpg\" alt=\"nacos服务列表\">\n<strong>netty-server实例注册成功</strong>，见下图\n<img src=\"../../img/nacos_tcc_server_instances.jpg\" alt=\"netty-server实例\">\n<strong>web实例注册成功</strong>，见下图\n<img src=\"../../img/nacos_tcc_transaction_server_instances.jpg\" alt=\"web实例\"></p>\n<p>恭喜你，server集群模式搭建完成！</p>\n",
  "link": "/zh-cn/docs/ops/server/deploy-cluster.html",
  "meta": {}
}