{
  "filename": "jdbc.md",
  "__html": "<h1 id=\"jdbc%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B\">jdbc存储类型 <a class=\"header-anchor\" href=\"#jdbc%E5%AD%98%E5%82%A8%E7%B1%BB%E5%9E%8B\">#</a></h1>\n<p>适用于服务单机、集群部署的场景。</p>\n<p>此种存储类型，适用于符合jdbc规范的数据库。</p>\n<p>详见实现<strong>JdbcTransactionStorage</strong></p>\n<h2 id=\"%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8\">如何使用 <a class=\"header-anchor\" href=\"#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8\">#</a></h2>\n<p>这里以mysql为例。</p>\n<h3 id=\"%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE\">创建数据 <a class=\"header-anchor\" href=\"#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE\">#</a></h3>\n<p>这里默认使用数据库名为TCC，开发者可以自行修改。<br>\n最新脚本请<a href=\"https://github.com/changmingxie/tcc-transaction/blob/master-2.x/tcc-transaction-core/src/main/dbscripts/db.sql\">查看</a></p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">DATABASE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`TCC`</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> <span class=\"hljs-string\">'utf8mb4'</span> <span class=\"hljs-keyword\">COLLATE</span> <span class=\"hljs-string\">'utf8mb4_unicode_ci'</span>;\n\n<span class=\"hljs-keyword\">USE</span> <span class=\"hljs-string\">`TCC`</span>;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`TCC_TRANSACTION`</span> (\n  <span class=\"hljs-string\">`TRANSACTION_ID`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`DOMAIN`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`ROOT_DOMAIN`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`ROOT_XID`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">64</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`XID`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">64</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`CONTENT`</span> varbinary(<span class=\"hljs-number\">8000</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`STATUS`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`TRANSACTION_TYPE`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`RETRIED_COUNT`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`IS_DELETE`</span> <span class=\"hljs-built_in\">tinyint</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`CREATE_TIME`</span> datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`LAST_UPDATE_TIME`</span> datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`VERSION`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`TRANSACTION_ID`</span>),\n  <span class=\"hljs-keyword\">UNIQUE</span> <span class=\"hljs-keyword\">KEY</span> <span class=\"hljs-string\">`UX_XID`</span> (<span class=\"hljs-string\">`XID`</span>)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`TCC_DOMAIN`</span> (\n  <span class=\"hljs-string\">`ID`</span> <span class=\"hljs-built_in\">bigint</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`DOMAIN`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`PHONE_NUMBERS`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">250</span>),\n  <span class=\"hljs-string\">`ALERT_TYPE`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">10</span>),\n  <span class=\"hljs-string\">`THRESHOLD`</span> <span class=\"hljs-built_in\">integer</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-string\">`INTERVAL_MINUTES`</span> <span class=\"hljs-built_in\">integer</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-number\">0</span>,\n  <span class=\"hljs-string\">`LAST_ALERT_TIME`</span> datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`DING_ROBOT_URL`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">250</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`CREATE_TIME`</span> datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`LAST_UPDATE_TIME`</span> datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`VERSION`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`ID`</span>),\n  <span class=\"hljs-keyword\">UNIQUE</span> <span class=\"hljs-keyword\">KEY</span> <span class=\"hljs-string\">`UX_DOMAIN`</span> (<span class=\"hljs-string\">`DOMAIN`</span>)\n) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;\n</code></pre>\n<h3 id=\"%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE\">添加配置 <a class=\"header-anchor\" href=\"#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE\">#</a></h3>\n<p>可如下配置，查看<a href=\"/zh-cn/docs/tutorial/configurations.html#jdbcstoreproperties\">更多jdbc配置</a></p>\n<pre><code class=\"language-properties\"><span class=\"hljs-meta\">spring.tcc.storage.storageType</span>=<span class=\"hljs-string\">jdbc</span>\n<span class=\"hljs-meta\">spring.tcc.storage.jdbc.driverClass</span>=<span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n<span class=\"hljs-meta\">spring.tcc.storage.jdbc.jdbcUrl</span>=<span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/TCC?useSSL=false&amp;connectTimeout=1000&amp;socketTimeout=5000</span>\n<span class=\"hljs-meta\">spring.tcc.storage.jdbc.username</span>=<span class=\"hljs-string\">root</span>\n<span class=\"hljs-meta\">spring.tcc.storage.jdbc.password</span>=<span class=\"hljs-string\">welcome1</span>\n</code></pre>\n<h3 id=\"maven%E4%BE%9D%E8%B5%96\">maven依赖 <a class=\"header-anchor\" href=\"#maven%E4%BE%9D%E8%B5%96\">#</a></h3>\n<pre><code class=\"language-xml\"> <span class=\"hljs-comment\">&lt;!--tcc-transaction中测试使用版本为5.1.48--&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>${mysql.version}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n",
  "link": "/zh-cn/docs/tutorial/storagetype/jdbc.html",
  "meta": {}
}